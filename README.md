# KarutaMovieClip

競技かるたの動画から札が読まれている部分のみを抽出するユーティリティです。


## インストール
[リリースページ](https://github.com/kamomemew/KarutaMovieClip/releases)からダウンロードし、解凍してください。<br>
このソフトウェアは動画編集には[LosslessCut](https://github.com/mifi/lossless-cut/)を使用するので、こちらもインストールしておいてください。(こちらも基本的に解凍するだけです。)
LossLessCutのインストールについてはここで詳しく触れませんが、表示を日本語にしておくと便利です。


## 設定
KMC.batを起動してください。
初回起動時にLosslessCutのフォルダを聞くので、LosslessCutのフォルダ(たとえば`C:\Program Files (x86)\LosslessCut-win-x64\`など)
を入力してください。
`configure.json`は設定ファイルです。
ノイズ部分が多く含まれてしまう場合には"silence_threshold"の値を上げ、読みが途中で短く切れてしまう場合には下げてください。

## 動画選択
続いて動画を選んでください。<br>
このソフトは無音判定のためにffmpegを呼んでいます。ffmpegで読み込み可能な動画なら処理できるはずです。
終わると動画と同じフォルダにsegment.csvというファイルができます。


## 動画のカット
本当は面倒なのはこの後なのですが…
動画のカットはLosslessCutで行ってください。
LosslessCutで動画を読み込んだあと、ファイル > プロジェクトインポート > 秒単位の時間(CSV) よりsegment.csvを読み込ませます。
おおむね読みの部分が残っているはずです。
(実験的に下の句分離機能を付けたので、有効にすると明らかに下の句である部分は分離されます。)

LosslessCutでセグメントを再生し、上の句が入っているセグメントを残しそのほかは削除します。

## 取り中心に切り出し
上の句のセグメントを抽出後、LosslessCutにてCSVファイルにエクスポートし、そのCSVファイルを表計算ソフトで読み込み、上の句の始まりを起点に秒数を付け直します。

下記の例では、130秒から上の句が始まり、136.2秒で終わります。
```csv
130.0,136.2,kami_30
```

これを上の句の起点である130秒から前2秒(余韻+αくらい)、後ろ3.5秒(初句程度)を中心に秒数を付けなおすと、
```csv
128.0,133.5,kami_30
```
のようになります。
これで上の句を中心に取りの部分になるので、再度LosslessCutにこのCSVファイルを読みこみ、動画を出力してください。
(この時、以前のセグメントは「セグメント > 全てのセグメントを消去」から消しておきます。)
